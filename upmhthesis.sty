% ============================================================
% MoAE-UPMH Thesis
% LaTeX Template - Version 2.0 (15/09/2021)
%
% Adapted to MoAE-UPMH requirements by Oscar Federico García Castro
%
% Contact: 213220003@upmh.edu.mx / Telegram: @Oscar_Federico
%
% Template license:
% CC BY-NC-SA 3.0 (http://creativecommons.org/licenses/by-nc-sa/3.0/)
%
% ============================================================

\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{upmhthesis}[2021/05/27 Thesis template]

% ============================================================
% PACKAGES AND OTHER DOCUMENT CONFIGURATIONS
% ============================================================
\RequirePackage[utf8]{inputenc}
\RequirePackage[spanish,es-nodecimaldot,es-tabla,english]{babel}    
\RequirePackage[T1]{fontenc}
\RequirePackage{eurosym}
\RequirePackage{pdfpages}
\RequirePackage{setspace}
\RequirePackage{appendix}
    \renewcommand{\appendixname}{Apéndice}

\RequirePackage{silence}
    \WarningFilter{latex}{Text page}

% \RequirePackage[xfp,fp]{spreadtab}
%     \STsetdecimalsep{.}
%     \STautoround*{4}

\RequirePackage[all]{xy}

\RequirePackage{xcolor,colortbl,graphicx,tikz,tikz-3dplot,varwidth,pgfplots,pgfplotstable} % Images, plots, colors
    \DeclareGraphicsExtensions{.png,PNG,.pdf,.PDF,.jpg,.JPG}
    \usepgfplotslibrary{groupplots}{}

    \pgfplotsset{compat=newest, cycle list name=auto} % Allows to place the legend below plot
    \usepgfplotslibrary{units} % Allows to enter the units nicely

    \usetikzlibrary{positioning}
    \usetikzlibrary{decorations.pathreplacing}
    \usetikzlibrary{arrows,decorations.markings}
    \usetikzlibrary{bending,shapes,fadings,patterns}
    \AtBeginEnvironment{tikzpicture}{\shorthandoff{>}\shorthandoff{<}}{}{}
    \pgfplotsset{ylabsh/.style={every axis y label/.style={at={(0,0.5)}, xshift=#1, rotate=90}}}
    \usepgfplotslibrary{colorbrewer}

    % Define colors for plots
    \definecolor{colorbrewer1}{RGB}{228,26,28}
    \definecolor{colorbrewer2}{RGB}{55,126,184}
    \definecolor{colorbrewer3}{RGB}{77,175,74}
    \definecolor{colorbrewer4}{RGB}{152,78,163}
    \definecolor{colorbrewer5}{RGB}{255,127,0}
    \definecolor{colorbrewer6}{RGB}{255,255,51}
    \definecolor{colorbrewer7}{RGB}{166,86,40}
    \definecolor{colorbrewer8}{RGB}{247,129,191}

    \pgfplotscreateplotcyclelist{Dark}{
        colorbrewer1\\
        colorbrewer2\\
        colorbrewer3\\
        colorbrewer4\\
        colorbrewer5\\
        colorbrewer6\\
        colorbrewer7\\
        colorbrewer8\\
    }
    
    \usepgfplotslibrary{fillbetween}
    \tikzset {
        port/.style={inner sep=0pt, font=\small},
        cross/.style={
            path picture={
                \draw   (path picture bounding box.north west) --
            (path picture bounding box.south east)
            (path picture bounding box.south west) --
            (path picture bounding box.north east);
            }
        },
        sum/.style n args={4}{
            draw, circle, minimum size=2em, cross, alias=sum,
            append after command={%
                node at (sum.north) [port, below=1pt] {$#1$}
                node at (sum.west)  [port, right=1pt] {$#2$}
                node at (sum.south) [port, above=1pt] {$#3$}
                node at (sum.east)  [port, left=1pt ] {$#4$}
            },
        },
    }

    \tikzset {
        pitchref/.style={dashed, black, line width=1pt},
        yawref/.style={dashed, black, line width=1pt},
        pitch/.style={solid, colorbrewer1, line width=1pt},
        yaw/.style={solid, colorbrewer2, line width=1pt},
        epitch/.style={pitch, dashdotted},
        eyaw/.style={yaw, dashdotted},
    }

    \pgfplotsset{
        std chart/.style={
            axis line style=thick,
            ylabel style={align=center},
            height=4cm, width=0.45\textwidth,
            enlarge x limits=0.025,
            enlarge y limits=0.05,
        },
        std boxed chart/.style={
            axis line style=thick,
            xmin=0, xmax=60,
            ylabel style={align=center},
            height=4cm, width=0.475\textwidth,
            legend columns=-1,
            legend style={draw=none},
            enlarge x limits=0.025,
            enlarge y limits=0.05,
            major grid style={solid, line width=.5pt, draw=gray!50},
            xmajorgrids={true},
        },
        std middle chart/.style={
            axis line style=thick,
            enlargelimits,
            axis lines=middle,
            enlarge x limits=0.15,
            enlarge y limits=0.15,
            ylabel style={align=center},
            height=5cm, width=0.95\textwidth, legend style={draw=none},
            legend columns=-1,
        },
        std y chart/.style={
            width=\textwidth,
            height=5cm,
            ybar,
            nodes near coords,
            every node near coord/.append style={rotate=90, anchor=west},
            bar width=10pt,
            legend style={at={(0.5,1.25)}, anchor=north, legend columns=-1, draw=none},
            y tick label style={/pgf/number format/.cd, fixed, fixed zerofill, precision=2, /tikz/.cd},
            every x tick label/.append style={font=\normalsize},
            x tick label style={rotate=90,anchor=east},
        }
    }

\RequirePackage{lmodern,emptypage,float,subcaption}
\RequirePackage{caption}
    \captionsetup{format=plain, labelfont=bf, font=small, width=\linewidth, hypcap=false}
    
\RequirePackage{titlesec,microtype}
\RequirePackage{fancyhdr}
\RequirePackage{tocloft}
\RequirePackage[acronym, symbols, nomain, nonumberlist, section, nopostdot, style=alttree]{glossaries}

    \renewcommand{\glossarypreamble}{\glsfindwidesttoplevelname[\currentglossary]}
    \setglossarystyle{alttree}

    \newglossaryentry{symbol}{name={\textbf{Variables}}, description={\nopostdesc}, type=symbols}
    \newglossaryentry{notation}{name={\textbf{Notación}}, description={\nopostdesc}, type=symbols}

    \newglossary[dct]{dictionary}{dot}{dtn}{Glosario}

    \glsaddstoragekey{unit}{}{\glossentryunit}
    \glsnoexpandfields
    
    \newglossarystyle{supergroup}{%
        \setglossarystyle{long3col}%
        \renewcommand*{\glsgroupskip}{}%
        \renewcommand{\glossentry}[2]{%
            \tabularnewline
            \multicolumn{2}{c}{%
                \bfseries\glsentryitem{##1}\glstarget{##1}{\glossentryname{##1}}%
            }% 
            \tabularnewline
            \tabularnewline
        }%
        \renewcommand{\subglossentry}[3]{%
            \glssubentryitem{##2}%
            \glstarget{##2}{\glossentryname{##2}}
            & \glossentrydesc{##2}\glspostdescription
            & \glossentryunit{##2}\tabularnewline
        }%
    }
    
\RequirePackage{amssymb,amsmath,amsbsy,amsfonts,mathrsfs,amsthm}
\RequirePackage{eqexpl,eucal,cancel}
\RequirePackage{bookmark,hyperref}
\RequirePackage{suffix}
\RequirePackage{nameref}
    \newcommand{\titleref}[1]{\emph{\nameref{#1}}}

\RequirePackage[spanish]{cleveref}
    \crefname{section}{sección}{secciones}
    \Crefname{section}{Sección}{Secciones}
    \crefname{figure}{Figura}{Figuras}
    \crefname{table}{Tabla}{Tablas}

    \let\sin\relax                  % undefine '\sin' first
    \DeclareMathOperator{\sin}{sen} % redefine '\sin'
    
\RequirePackage{listings}
    \definecolor{codegreen}{rgb}{0,0.6,0}
    \definecolor{codegray}{rgb}{0.5,0.5,0.5}
    \definecolor{codepurple}{rgb}{0.58,0,0.82}
    \definecolor{backcolour}{rgb}{0.95,0.95,0.92}
        
    \lstdefinestyle{mystyle}{
        backgroundcolor=\color{backcolour},
        commentstyle=\color{codegreen},
        keywordstyle=\color{magenta},
        numberstyle=\tiny\color{codegray},
        stringstyle=\color{codepurple},
        basicstyle=\ttfamily\scriptsize,
        breakatwhitespace=false,
        breaklines=true,
        captionpos=b,
        keepspaces=true,
        numbers=left,
        numbersep=5pt,
        showspaces=false,
        showstringspaces=false,
        showtabs=false,
        tabsize=2,
        language=Matlab,
    }
        
    \lstset{style=mystyle}
    \lstset{literate=%
        {Ö}{{\"O}}1
        {Ä}{{\"A}}1
        {Ü}{{\"U}}1
        {ß}{{\ss}}2
        {ü}{{\"u}}1
        {ä}{{\"a}}1
        {ö}{{\"o}}1
        {á}{{\'a}}1
        {é}{{\'e}}1
        {í}{{\'i}}1
        {ó}{{\'o}}1
        {ú}{{\'u}}1
        {Á}{{\'A}}1
        {É}{{\'E}}1
        {Í}{{\'I}}1
        {Ó}{{\'O}}1
        {Ú}{{\'U}}1
    }

\RequirePackage{makeidx}
\RequirePackage{tablefootnote,threeparttable,longtable,multicol,multirow,booktabs,adjustbox,array}

    \definecolor{rulecolor}{RGB}{0,71,171}
    \definecolor{tableheadcolor}{gray}{0.90}
    \definecolor{tablemidcolor}{gray}{0.925}

    \newcolumntype{P}[1]{>{\centering\arraybackslash}p{#1}}

    \newcommand{\topline}{
        \arrayrulecolor{rulecolor}\specialrule{0.1em}{\abovetopsep}{0pt}
        \arrayrulecolor{tableheadcolor}\specialrule{\belowrulesep}{0pt}{0pt}
        \arrayrulecolor{rulecolor}}

    \newcommand{\midtopline}{
        \arrayrulecolor{tableheadcolor}\specialrule{\aboverulesep}{0pt}{0pt}
        \arrayrulecolor{rulecolor}\specialrule{\lightrulewidth}{0pt}{0pt}
        \arrayrulecolor{white}\specialrule{\belowrulesep}{0pt}{0pt}
        \arrayrulecolor{rulecolor}}

    \newcommand{\bottomline}{
        \arrayrulecolor{white}\specialrule{\aboverulesep}{0pt}{0pt}
        \arrayrulecolor{rulecolor}
        \specialrule{\heavyrulewidth}{0pt}{\belowbottomsep}}

    \newcommand{\midheader}[2]{
        \midrule\topmidheader{#1}{#2}}
    \newcommand\topmidheader[2]{\multicolumn{#1}{c}{\textsc{#2}}\\
        \addlinespace[0.5ex]}

\RequirePackage{libertine}
\RequirePackage[nottoc,notlot,notlof]{tocbibind}

\RequirePackage{needspace}
\RequirePackage[chapter]{algorithm}
\RequirePackage{algpseudocode}
    \renewcommand{\thealgorithm}{\arabic{chapter}.\arabic{algorithm}}

    \floatname{algorithm}{Algoritmo}
    \renewcommand{\listalgorithmname}{Lista de algoritmos}
    \renewcommand{\algorithmicrequire}{\textbf{Entrada:}}
    \renewcommand{\algorithmicprocedure}{\textbf{procedimiento:}}
    \renewcommand{\algorithmicensure}{\textbf{Salida:}}
    \renewcommand{\algorithmicend}{\textbf{fin}}
    \renewcommand{\algorithmicif}{\textbf{si}}
    \renewcommand{\algorithmicthen}{\textbf{entonces}}
    \renewcommand{\algorithmicelse}{\textbf{si no}}
    \renewcommand{\algorithmicfor}{\textbf{para}}
    \renewcommand{\algorithmicforall}{\textbf{para todo}}
    \renewcommand{\algorithmicdo}{\textbf{hacer}}
    \renewcommand{\algorithmicwhile}{\textbf{mientras}}
    \renewcommand{\algorithmicloop}{\textbf{repetir}}
    \renewcommand{\algorithmicrepeat}{\textbf{repetir}}
    \renewcommand{\algorithmicuntil}{\textbf{hasta que}}
    \renewcommand{\algorithmicreturn}{\textbf{devolver}}

\RequirePackage{bbding}
\RequirePackage[inline]{enumitem}
	\renewcommand{\labelitemi}{$\bullet$}
    \renewcommand{\labelitemii}{$\ast$}
    \renewcommand{\labelitemiii}{$\diamond$}
    \renewcommand{\labelitemiv}{$-$}

    \renewcommand{\theenumi}{\alph{enumi}}
    \renewcommand{\labelenumi}{{\theenumi})}

    \setlist[enumerate,1]{label=\textit{\alph*)}}

    \newlist{questions}{enumerate}{1}
    \setlist[questions]{label=\arabic*., wide=0pt, font=\bfseries}
    \let\question=\item

\RequirePackage[none]{hyphenat}
\RequirePackage[autostyle=false, german=quotes]{csquotes}

\RequirePackage[backend     =biber,
                sorting     =none,
                citestyle   =ieee,
                sortcites,
                style       =ieee,
                natbib      =true,
                maxcitenames=2,
                mincitenames=1,
                uniquelist  =false,
                doi         =true]{biblatex}

    \DefineBibliographyStrings{spanish}{
        andothers={\textit{et\addabbrvspace \'al\adddot}},
        and      ={y}
    }

\RequirePackage{url}
    \urlstyle{same}

\RequirePackage{latexsym,sidecap,pgfplots,siunitx}
    \sisetup{
        output-decimal-marker = {.},
        group-separator = {,}
    }
    \DeclareSIUnit[quantity-product = ]\percent{\char`\%}
    

\RequirePackage[framemethod=default]{mdframed} % Required for creating the theorem, definition, exercise and corollary boxes

% \RequirePackage[bottom]{footmisc}
    \renewcommand{\thefootnote}{\fnsymbol{footnote}}
    \counterwithin*{footnote}{chapter}

    \newcommand{\addcomment}[1]{{\Large\itshape\textcolor{red}{#1}}}

\@ifpackageloaded{geometry}{}{\RequirePackage[pass]{geometry}}
    \emergencystretch=1em
    \graphicspath{{./graphics/}}
    \DeclareGraphicsExtensions{.png,.jpg,.pdf,.eps,.svg,.mps}

    % ========================================================
    % DEFINITION OF COLORS
    % ========================================================
    \definecolor{miaBlue}{RGB}{37,73,114} % Line for cover pages
    \definecolor{line_color}{rgb}{0.03, 0.27, 0.49} % Color: DARK CERULEAN, for theorems, etc.
    \definecolor{block_color}{rgb}{0.15, 0.38, 0.61} % Color: LAPIS LAZULI

    % ========================================================
    % THESIS INFORMATION
    % ========================================================
    \newcommand*{\university}[1]{\gdef\@university{#1}}
    \newcommand*{\faculty}[1]{\gdef\@faculty{#1}}
    \newcommand*{\degree}[1]{\gdef\@degree{#1}}
    \newcommand*{\supervisor}[1]{\gdef\@supervisor{#1}}
    \newcommand*{\cityandyear}[1]{\gdef\@cityandyear{#1}}
    \newcommand*{\logouniversity}[1]{\gdef\@logouniversity{#1}}
    \newcommand*{\logoconacyt}[1]{\gdef\@logoconacyt{#1}}
    \newcommand*{\logofaculty}[1]{\gdef\@logofaculty{#1}}
    \newcommand*{\subject}[1]{\gdef\@subject{#1}}
    \newcommand*{\keywords}[1]{\gdef\@keywords{#1}}

    \newcommand*{\@university}{\texttt{\string\university}Instituto}
    \newcommand*{\@faculty}{\texttt{\string\faculty}Facultad o Instituto}
    \newcommand*{\@degree}{\texttt{\string\degree}Grado de estudios}
    \newcommand*{\@supervisor}{\texttt{\string\supervisor}Supervisor}
    \newcommand*{\@cityandyear}{\texttt{\string\cityandyear}Lugar y fecha}
    \newcommand*{\@logouniversity}{example-A}
    \newcommand*{\@logofaculty}{example-B}
    \newcommand*{\@logoconacyt}{example-C}
    \newcommand*{\@subject}{Tema de investigación}
    \newcommand*{\@keywords}{Palabras clave}

    \newcommand*{\universityEN}[1]{\gdef\@universityEN{#1}}
    \newcommand*{\facultyEN}[1]{\gdef\@facultyEN{#1}}
    \newcommand*{\titleEN}[1]{\gdef\@titleEN{#1}}
    \newcommand*{\authorEN}[1]{\gdef\@authorEN{#1}}
    \newcommand*{\keywordsEN}[1]{\gdef\@keywordsEN{#1}}

    \newcommand*{\@universityEN}{\texttt{\string\universityEN}University}
    \newcommand*{\@facultyEN}{\texttt{\string\facultyEN}Institute}
    \newcommand*{\@titleEN}{\texttt{\string\titleEN}Title}
    \newcommand*{\@authorEN}{\texttt{\string\authorEN}Author}
    \newcommand*{\@keywordsEN}{\texttt{\string\keywordsEN}Keywords}
    % ========================================================
    % COVER PAGE
    % ========================================================
    \renewcommand*{\maketitle}{
        \renewcommand{\thepage}{C-\arabic{page}}
        \pdfbookmark[0]{Portada}{Portada}
        \begin{titlepage}
            \newgeometry{margin=0.75in}
            \noindent
            \hspace{0mm}
            \begin{minipage}[c][0.15\textheight][c]{\textwidth}
                \noindent
                \hspace{1cm}
                \begin{minipage}[t][0.15\textheight][c]{2.5cm}
                    \includegraphics[height=2.75cm]{\@logofaculty}
                \end{minipage}\hspace{5mm}
                \begin{minipage}[t][0.15\textheight][c]{0.75\textwidth}
                    \centering
                    \vspace{3cm}{\large\scshape \@university\par}
                    \vspace{5mm}{\color{miaBlue}\hrule height1pt}
                    \vspace{2mm}{\color{miaBlue}\hrule height4pt}
                    \vspace{2mm}{\color{miaBlue}\hrule height1pt}
                    \vspace{5mm}{\large\scshape\@faculty\unskip\par}
                    \vspace{24mm}
                \end{minipage}\hspace{5mm}
            \end{minipage}

            \vspace{2cm}

            \begin{minipage}[c][0.15\textheight][c]{0.2\textwidth}
                \noindent
                \begin{center}
                    {\color{miaBlue}
                        \vrule width1pt height0.632\textheight
                        \hskip3mm
                        \vrule width4pt height0.632\textheight
                        \hskip3mm
                        \vrule width1pt height0.632\textheight
                    }
                \end{center}
                \begin{minipage}[t][0.15\textheight][c]{2.5cm}
                    \includegraphics[height=2cm]{\@logouniversity}
                \end{minipage}\hspace{5mm}
            \end{minipage}
            \hspace{0.05\textwidth}
            \begin{minipage}[c][0.65\textheight][t]{0.64\textwidth}
                \begin{center}
                     \doublespacing
                    {\LARGE\scshape\@title}\\[20mm]

                    \singlespacing
                    \textsc{\LARGE T\hspace{15mm}E\hspace{15mm}S\hspace{15mm}I\hspace{15mm}S}\\[10mm]
                    \textsc{\large PARA OBTENER EL GRADO DE:}\\[5mm]
                    \textsc{\large \@degree}\\[10mm]
                    \textsc{\large\textbf{P R E S E N T A}}\\[2.5mm]
                    \textsc{\large\textbf\scshape\@author}\\[20mm]
                    {\large\scshape ASESORES:\\[0.3cm] {\@supervisor}}\\[2cm]
                    {\scshape\@cityandyear}
                    \vspace{.99cm}
                \end{center}
            \end{minipage}
        \end{titlepage}

    % ========================================================
    % TITLE PAGE
    % ========================================================
        \cleardoublepage
        \begin{titlepage}
            \setcounter{page}{3}
            \newgeometry{left=3cm, right=3.5cm, bottom=4.5cm, top=4.5cm}
            \noindent
            \begin{minipage}[c][0.99\textheight][c]{0.14\textwidth}%
                \noindent\begin{minipage}[t][0.15\textheight][c]{\textwidth}
                    \begin{center}
                        \includegraphics[height=15mm]{\@logouniversity}\\[0.5cm]
                        \includegraphics[height=20mm]{\@logofaculty}\\[0.5cm]
                        \includegraphics[height=20mm]{\@logoconacyt}
                    \end{center}
                    \vspace{16.5cm}
                \end{minipage}%
                \noindent\begin{minipage}[c][0.66\textheight][c]{0.65\textwidth}
                \begin{center}
                    \color{miaBlue}
                    \hskip6mm
                    \vrule width4pt height\textheight
                    \hskip2mm
                    \vrule width1pt height\textheight
                \end{center}
            \end{minipage}%
        \end{minipage}
        \hspace{15mm}
        \begin{minipage}[c][0.97\textheight][t]{0.8\textwidth}
            \vspace{2cm}
            \begin{flushleft}
                \textit{\@title}, \@author\\[2em]
                Esta tesis fue preparada en \LaTeX\,usando la plantilla \href{https://github.com/oscarfedegc/UPMH-PlantillaTesis}{https://github.com/oscarfedegc/UPMH-PlantillaTesis}.\\
                % Contiene un total de X páginas.\\
                Compilada el \@date.
            \end{flushleft}
            \vfill
            \end{minipage}
        \end{titlepage}
    }

    % ========================================================
    % MARGIN SETTINGS
    % ========================================================
    \newgeometry{
        top   =1in,
        bottom=1in,
        outer =1in,
        inner =1.5in
    }
        \setlength{\headheight}{0.75cm}
        \setlength{\headsep}{0.5cm}

    % ========================================================
    % HYPERREF SETTINGS
    % ========================================================
    \definecolor{link_color}{rgb}{0,0.29,0.29} % DEEP JUNGLE GREEN
    \definecolor{cite_color}{rgb}{0.24,0.08,0.08} % DARK SIENNA
    \definecolor{url_color}{rgb}{0,0.18,0.39} % COOL BLACK
    \definecolor{anchor_color}{rgb}{0.44,0.26,0.08} % SEPIA

    \hypersetup{
        bookmarksopen    =false,
        bookmarksnumbered=true,
        breaklinks       =true,
        colorlinks       =true,
        linkcolor        =black,
        urlcolor         =black,
        citecolor        =black,
        anchorcolor      =black,
        linktocpage      =true,
    }
    \phantomsection
    \glsdisablehyper

    \newrobustcmd*{\citefirstlastauthor}{\AtNextCite{\DeclareNameAlias{labelname}{given-family}}\citet}

    \addbibresource{references/library.bib}
    \addbibresource{references/books.bib}
    \addbibresource{references/thesis.bib}
    \addbibresource{references/articles.bib}

    % ========================================================
    % HEADER SETTINGS
    % ========================================================

    % ========================================================
    % TABLE OF CONTENT SETTINGS
    % ========================================================
    \makeatletter
        \renewcommand{\@pnumwidth}{1cm}
        % \renewcommand{\@tocrmarg}{4cm}
        % \renewcommand{\cftdotsep}{\cftnodots}
    \makeatother

    \renewcommand{\cftchappresnum}{\chaptername\space}
    \setlength{\cftchapnumwidth}{\widthof{\textbf{Apéndice\,999\,}}}

    \makeatletter\g@addto@macro\appendix{
        \addtocontents{toc}{\protect\renewcommand{\protect\cftchappresnum}{\appendixname\space}}
    }

    \newcommand\appendixsetup{
        \cleardoublepage
        \lhead[~]{\nouppercase{\textit{\appendixname\,\leftmark}}}
        \setcounter{chapter}{1}
        \addtocontents{toc}{\protect\renewcommand{\protect\cftchappresnum}{\appendixname\space}}
    }

    \newcommand\annexsetup{
        \cleardoublepage
        \lhead[~]{\nouppercase{\textit{Anexo\,\leftmark}}}
        \setcounter{chapter}{1}
        \addtocontents{toc}{\protect\renewcommand{\protect\cftchappresnum}{Anexo\space}}
    }

    % ========================================================
    % CHAPTER TITLE SETTINGS
    % ========================================================
    \definecolor{titlecolor}{RGB}{0,0,0} % Color: BLACK
    \newcommand{\chaptertitlerule}{
        \color{titlecolor}\Huge\textbf}

    \newcommand{\formatchaptermain}{
        \renewcommand{\headrulewidth}{1pt}
        \pagestyle{fancy}
        \rhead[\nouppercase{\textit{Sección\,\rightmark}}]{~}
        \lhead[~]{\nouppercase{\textit{Capítulo\,\leftmark}}}
    }

    \renewcommand{\headrulewidth}{0.4pt}

    \newcommand{\initchapter}[1]{
        \chapter{#1}
        \markboth{\thechapter.\hspace{5pt}#1}{}}

    \newcommand{\initchapterlong}[2]{
        \chapter[#1]{#2}
        \markboth{\thechapter.\hspace{5pt}#1}{}}

    \WithSuffix\newcommand\initchapter*[2]{
        \chapter*{#1}
        \addcontentsline{toc}{chapter}{#1}
        \markboth{#1}{}}

    \newcommand{\initappendix}[1]{
        \chapter{#1}
        \markboth{\thechapter.\hspace{5pt}#1}{}}

    \newcommand{\initannex}[1]{
        \chapter{#1}
        \markboth{\thechapter.\hspace{5pt}#1}{}}

    % ========================================================
    % SECTION TITLE SETTINGS
    % ========================================================
    \newcommand{\pagelinknum}{\cleardoublepage\phantomsection}

    \newcommand{\prefchapter}[1]{
        \bookmarksetup{startatroot}
        \pagelinknum
        \chapter*{#1}
        \addcontentsline{toc}{section}{#1}}

    \newcommand{\formatsectionmain}{
        \titleformat{\section}[hang]
            {\color{titlecolor}\large\bfseries
            \begingroup
                \setlength{\titlewidth}{3cm}
                \titleline*[l]{\titlerule[.4pc]}
                \setlength{\titlewidth}{\columnwidth}
                \vspace{-1pt}
                \titlerule[2.5pt]\vskip6pt
            \endgroup}
            {\thesection}
            {15pt}
            {\color{titlecolor}}
    }

    % ========================================================
    % GLOSSARIES SETTINGS
    % ========================================================
    \makeglossaries

    \loadglsentries[acronym]{backmatter/abbreviations}
    \loadglsentries{backmatter/glossary}
    \loadglsentries[acronym]{backmatter/acronyms}
    \loadglsentries[symbols]{backmatter/symbols}
    \loadglsentries[symbols]{backmatter/notation}

    % ========================================================
    % NEURAL NETWORK SETTINGS
    % ========================================================
    \pgfplotsset{compat=newest} % Allows to place the legend below plot
    \usepgfplotslibrary{units} % Allows to enter the units nicely
    \usetikzlibrary{decorations.pathreplacing}
    \usetikzlibrary{arrows, decorations.markings}
    \usetikzlibrary{fadings}
    \usetikzlibrary{mindmap,trees,backgrounds,shadows,spy}
    \AtBeginEnvironment{tikzpicture}{\shorthandoff{>}
        \shorthandoff{<}}{}{}

    \tikzset {
        every pin edge/.style={draw=white},
        port/.style={inner sep=0pt, font=\small},
        cross/.style={
            path picture={
                \draw   (path picture bounding box.north west) --
                        (path picture bounding box.south east)
                        (path picture bounding box.south west) --
                        (path picture bounding box.north east);
            }
        },
        sum/.style n args={4}{
            draw, circle, minimum size=2em, cross, alias=sum,
            append after command={%
                node at (sum.north) [port, below=1pt] {$#1$}
                node at (sum.west)  [port, right=1pt] {$#2$}
                node at (sum.south) [port, above=1pt] {$#3$}
                node at (sum.east)  [port, left=1pt ] {$#4$}
            },
        },
    }

    \usetikzlibrary{external}
    \tikzexternalize[prefix=figures/] % activate
    
    % Compile with: pdflatex -output-directory=build -shell-escape output
    %               pdflatex -output-directory=build -synctex=1 -interaction=nonstopmode --extra-mem-bot=10000000 --shell-escape output

    \tikzstyle{umlcd style enum}=[rectangle split, rectangle split parts=2, every text node part/.style={text centered}, draw, minimum height=2em, umlcolor, minimum width=2cm, text width=4cm, minimum height=1cm, node distance=2cm]

    \newenvironment{enum}[3][]
        {\begin{classAndInterfaceCommon}{#1}{#2}{#3}}
        {\node[umlcd style enum, anchor=north] (\umlcdClassName) at (\umlcdClassPos)
        {$<<$enumeration$>>$ \\ \textbf{\umlcdClassName}
            \nodepart{second}
            \umlcdClassAttributes
        };
        \end{classAndInterfaceCommon}
    }

    % ========================================================
    %	ABSTRACT PAGE DESIGN
    % ========================================================
    \newenvironment{abstractES}{
	\renewcommand{\headrulewidth}{0pt}
	\bookmarksetup{startatroot}
        \pagelinknum
        \addcontentsline{toc}{section}{\abstractname}
	\begin{center}
        \bigskip
            {\huge\textit{\abstractname} \par}
            {\normalsize\@faculty\par}
            \medskip
            {\normalsize\scshape\@university\par}
            \bigskip
            {\normalsize\bfseries\@title \par}
            \medskip
            {\normalsize por \@author \par}
            \bigskip
        \end{center}
    }
    {\\[2em]\textbf{Palabras clave}: \@keywords}

    \newenvironment{abstractEN}{
        \begin{otherlanguage}{english}
        \renewcommand{\headrulewidth}{0pt}
        \bookmarksetup{startatroot}
        \pagelinknum
        \addcontentsline{toc}{section}{Abstract}
        \begin{center}
            \bigskip
            {\huge\textit{Abstract} \par}
            \bigskip
            {\normalsize\@facultyEN\par}
            \medskip
            {\normalsize\scshape\@universityEN\par}
            \bigskip
            {\normalsize\bfseries\@titleEN \par}
            \medskip
            {\normalsize by \@authorEN \par}
            \bigskip
        \end{center}
        \end{otherlanguage}
    }
    {\\[2em]\textbf{Keywords}: \@keywordsEN}

    % ========================================================
    %	ACKNOWLEDGEMENT PAGE DESIGN
    % ========================================================
    \newcommand{\acknowname}{Agradecimientos}
    \newenvironment{acknowledgements}{\pagelinknum
        \begin{center}
            \bigskip
            {\huge\textit{\acknowname} \par}
            \bigskip
            \bigskip
        \end{center}}{}

    % ========================================================
    %	DEDICATION PAGE DESIGN
    % ========================================================
    \newcommand\dedicatory[1]{
        \renewcommand{\headrulewidth}{0pt}
        \null\vfil
        \begin{center}{\Large\slshape #1}\end{center}
        \vfil\null
    }

    \newcommand{\authorshipname}{Declaración de autenticidad}
    \newenvironment{declaration}{\pagelinknum
        {\begin{center}
            {\huge\textit{\authorshipname}\par\vspace{20pt}}
        \end{center}}}{}

    % ========================================================
    %	MATH SYMBOLS
    % ========================================================
    \newcommand{\cinterval}[2]{\ensuremath{[#1,#2]}}
    \newcommand{\laplace}[1]{\ensuremath{\displaystyle\mathscr{L} \left\{ #1 \right\} }}
    \newcommand{\invlaplace}[1]{\ensuremath{\displaystyle\mathscr{L}^{-1} \left\{ #1 \right\} }}
    \newcommand{\rst}[1]{\ensuremath{\tcboxmath[colback=gray!20!white, colframe=brandeisblue!70]{#1}}}

    \newcommand\cancl[2][blue!80]{\renewcommand\CancelColor{\color{#1}}\cancel{#2}}
    \newcommand\bcancl[2][blue!80]{\renewcommand\CancelColor{\color{#1}}\bcancel{#2}}
    \newcommand\canclto[3][blue!80]{\renewcommand\CancelColor{\color{#1}}\cancelto{#2}{#3}}
    \newcommand{\vectors}[1][v]{\ensuremath{\boldsymbol{#1}=(\foreach \i in {1,2,3}{#1_{\i}+} \cdots + #1_{n})}}
	\newcommand{\vectspace}[2][R]{\ensuremath{\boldsymbol{#1}^{#2}}}

	\raggedbottom
    \allowdisplaybreaks
    \spanishdecimal{.}

    \eqexplSetIntro{donde}  % set parenthesis in the left of the first item
    \eqexplSetDelim{=\,}    % set delimiter to ":"

\RequirePackage{array,tabularx}
    \newenvironment{conditions*}
        {\text{donde\,}\par\vspace{\abovedisplayskip}\noindent
        \tabularx{\columnwidth}{>{$}l<{$} @{${}={}$} >{\raggedright\arraybackslash}X}}
        {\endtabularx\par\vspace{\belowdisplayskip}}

	% ========================================================
    % MATH ENVIROMENT SETTINGS
    % ========================================================
    % Boxed/framed enviroments
    \newtheoremstyle{bluenumbox}    % Theorem style name
        {0pt}                       % Space above
        {0pt}                       % Space below
        {\normalfont}               % Body font
        {}                          % Indent amount
        {\small\bf\color{miaBlue}}  % Theorem head font
        {\;}                        % Punctuation after theorem head
        {0.25em}                    % Space after theorem head
        {\small\color{miaBlue}\thmname{#1}\nobreakspace\thmnumber{#2}~#3} % Optional theorem note

    \newtheoremstyle{colornumbox}   % Theorem style name
        {0pt}                       % Space above
        {0pt}                       % Space below
        {\normalfont}               % Body font
        {}                          % Indent amount
        {\small\bf\color{miaBlue}}  % Theorem head font
        {\;}                        % Punctuation after theorem head
        {0.25em}                    % Space after theorem head
        {\small\color{miaBlue}\thmname{#1}\nobreakspace\thmnumber{#2}~#3} % Optional theorem note

    \newtheoremstyle{blacknumex}    % Theorem style name
        {5pt}                       % Space above
        {5pt}                       % Space below
        {\normalfont}               % Body font
        {}                          % Indent amount
        {\small\bf}                 % Theorem head font
        {\;}                        % Punctuation after theorem head
        {0.25em}                    % Space after theorem head
        {\small\nobreakspace\thmname{#1}\nobreakspace\thmnumber{#2} #3} % Optional theorem note

    \newtheoremstyle{blacknumbox}   % Theorem style name
        {0pt}                       % Space above
        {0pt}                       % Space below
        {\normalfont}               % Body font
        {}                          % Indent amount
        {\small\bf}                 % Theorem head font
        {\;}                        % Punctuation after theorem head
        {0.25em}                    % Space after theorem head
        {\small\thmname{#1}\nobreakspace\thmnumber{#2}.~(#3)}

    % Non-boxed/non-framed environments
    \newtheoremstyle{bluenum}       % Theorem style name
        {5pt}                       % Space above
        {5pt}                       % Space below
        {\normalfont}               % Body font
        {}                          % Indent amount
        {\small\bf\color{miaBlue}}  % Theorem head font
        {\;}                        % Punctuation after theorem head
        {0.25em}                    % Space after theorem head
        {\small\color{miaBlue}\thmname{#1}\nobreakspace\thmnumber{\@ifnotempty{#1}{}\@upn{#2}}         % Theorem text (e.g. Theorem 2.1)
        \thmnote{\nobreakspace\the\thm@notefont\sffamily\bfseries\color{black}---\nobreakspace#3.}}     % Optional theorem note
    \makeatother

    % Defines the theorem text style for each type of theorem to one of the three styles above
    \newcounter{dummy}
	\numberwithin{dummy}{chapter}
    \theoremstyle{bluenumbox}
        \newtheorem{theoremeT}[dummy]{Teorema}
        \newtheorem{problem}{Problema}[chapter]
        \newtheorem{exerciseT}{Ejercicio}[chapter]

    \theoremstyle{blacknumex}
        \newtheorem{exampleT}{Ejemplo}[chapter]
        \numberwithin{exampleT}{chapter}

    \theoremstyle{blacknumbox}
        \newtheorem{definitionT}{Definici\'on}%[chapter]
        \newtheorem{corollaryT}[dummy]{Corolario}
        \numberwithin{definitionT}{chapter}

    \theoremstyle{bluenum}
        \newtheorem{proposition}[dummy]{Proposition}

    % =====	DEFINITION OF COLORED BOXES =====
    % Theorem box
    \newmdenv[	skipabove			= 7pt,
                skipbelow			= 7pt,
                backgroundcolor		= white,
                linecolor			= black!50,
                innerleftmargin		= 5pt,
                innerrightmargin	= 5pt,
                innertopmargin		= 5pt,
                leftmargin			= 0cm,
                rightmargin			= 0cm,
                innerbottommargin	= 5pt]{tBox}

    % Exercise box
    \newmdenv[	skipabove			= 7pt,
                skipbelow			= 7pt,
                rightline			= false,
                leftline			= true,
                topline				= false,
                bottomline			= false,
                backgroundcolor		= miaBlue!10,
                linecolor			= miaBlue,
                innerleftmargin		= 5pt,
                innerrightmargin	= 5pt,
                innertopmargin		= 5pt,
                innerbottommargin	= 5pt,
                leftmargin			= 0cm,
                rightmargin			= 0cm,
                linewidth			= 4pt]{eBox}

    % Definition box
    \newmdenv[  skipabove          =7pt,
                skipbelow          =7pt,
                rightline          =false,
                leftline           =true,
                topline            =false,
                bottomline         =false,
                linecolor          =miaBlue,
                innerleftmargin    =5pt,
                innerrightmargin   =5pt,
                innertopmargin     =0pt,
                leftmargin         =0cm,
                rightmargin        =0cm,
                linewidth          =4pt,
                innerbottommargin  =0pt]{dBox}

    % Corollary box
    \newmdenv[  skipabove          =7pt,
                skipbelow          =7pt,
                rightline          =false,
                leftline           =true,
                topline            =false,
                bottomline         =false,
                linecolor          =gray,
                backgroundcolor    =black!5,
                innerleftmargin    =5pt,
                innerrightmargin   =5pt,
                innertopmargin     =5pt,
                leftmargin         =0cm,
                rightmargin        =0cm,
                linewidth          =4pt,
                innerbottommargin  =5pt]{cBox}

    % Creates an environment for each type of theorem and assigns it a theorem text style from the "Theorem Styles" section above and a colored box from above
    \newenvironment{theorem}{\begin{tBox}\begin{theoremeT}}{\end{theoremeT}\end{tBox}}
    \newenvironment{exercise}{\begin{eBox}\begin{exerciseT}}{\hfill{\color{miaBlue}\tiny\ensuremath{\blacksquare}}\end{exerciseT}\end{eBox}}
    
    \newenvironment{definition}{\begin{dBox}\begin{definitionT}}{\end{definitionT}\end{dBox}}
    
    \newenvironment{example}{\begin{exampleT}}{\hfill{\tiny\ensuremath{\blacksquare}}\end{exampleT}}
    \newenvironment{corollary}{\begin{cBox}\begin{corollaryT}}{\end{corollaryT}\end{cBox}}

    \newcommand{\matrixstate}[9]{
        \begin{table}[H]
            \centering
            \begin{tabular}{|r|p{0.775\textwidth}|}
                \hline
                Título       & \citetitle{#1} \\ \hline
                Autor        & \citeauthor{#1} \\ \hline
                Año          & \citeyear{#1} \\ \hline
                Lugar        & #2 \\ \hline
                Objetivos    & #3 \\ \hline
                Muestra      & #4 \\ \hline
                Metodología  & #5 \\ \hline
                Técnica      & #6 \\ \hline
                Resultados   & #7 \\ \hline
                Conclusiones & #8 \\ \hline
                Aporte       & #7 \\ \hline
            \end{tabular}
        \end{table}
    }

    \newcommand{\bs}[1]{\boldsymbol{#1}}
    \newcommand{\putVect}[2]{[#1_1\,\,\,#1_2\,\,...\,\,\,#1_i\,\,\,...\,\,\,#1_#2]}
    \newcommand{\putMatrix}[2]{
        \ensuremath{\begin{bmatrix}
            #1_{\theta1} & #1_{\theta2} & \cdots & #1_{\theta#2}
        \end{bmatrix}}}

    \newcommand{\sci}[1]{$\times10^{#1}$}

    \newcommand{\fuzzyrule}[2]{\textbf{If} \emph{#1} \textbf{then} \emph{#2}}
    \newcommand{\fuzzymath}[4]{\textbf{If} $#1$ is $#2$ \textbf{then} $#3$ is $#4$}
    \newcommand{\fuzzycondition}[7]{\textbf{If} $#1$ is $#2$ \textbf{#3} $#4$ is $#5$ \textbf{then} $#6$ is $#7$}

    \newcommand{\fuzzytruncate}[5]{\textbf{If} $#1$ is $#2$ \textbf{#3} $#4$ is $#5$}

    % COLOR FOR TIKZ DIAGRAMS
    \definecolor{neuron_color}{rgb}{0.7, 0.11, 0.11}
    \definecolor{filter_color}{rgb}{0.85, 0.57, 0.0}
    \definecolor{sum_color}{rgb}{0.79, 0.0, 0.09}
    % \definecolor{neuron_color}{rgb}{0.8, 0.58, 0.46}

    \tikzset{ % NEURAL NETWORKS ANS FILTERS DIAGRAMS DEFINITIONS
        neuron sum/.style={draw, circle, fill=sum_color!25, inner sep=2pt, minimum width=1.25em},
        neuron function/.style={draw, circle, fill=teal!25, inner sep=2pt, minimum height=1cm, minimum width=1cm},
        filter sum/.style={draw, circle, minimum size=1em, fill=sum_color!25},
        neuron input/.style={draw, circle, fill=black, inner sep=2pt, minimum height=1pt, minimum width=1pt},
        neuron hidden/.style={neuron sum, fill=neuron_color!25},
        block function/.style={draw, fill=teal!20, rectangle, inner sep=1pt, minimum size=1cm, minimum width=1cm, text width=1cm, align=center},
        filter operation/.style={draw, circle, minimum size=1em, fill=orange!20},
        iir operation/.style={draw, rectangle, text width=2cm, minimum width=2cm, fill=orange!20, align=center},
        gain/.style={draw, isosceles triangle, fill=blue!30, minimum size=1.25cm, isosceles triangle apex angle=45},
    }

    \tikzset{ % CONTROL DIAGRAM DEFINITIONS
        control block/.style={draw, rectangle, fill=teal!20, inner sep=1pt, minimum height=1cm, text width=4cm, align=center},
        control plant/.style={control block, fill=red!20},
        control vector/.style={-stealth,black,very thick},
        connection/.style={draw, circle, fill=black, inner sep=2pt, minimum height=1pt, minimum width=1pt},
        control gain/.style={draw, rectangle, fill=teal!20, inner sep=1pt, minimum height=1cm, text width=2.5cm, align=center},
    }

    \definecolor{personcolor}{HTML}{0B3C74}
    \definecolor{systemcolor}{HTML}{1464B3}

    \tikzset{ % UML BLOCK  DEFINITIONS
        person block c4/.style={draw, rectangle, rounded corners=10mm, fill=personcolor, inner sep=10pt, minimum height=1cm, text width=4cm, align=center, text=white},
        system block c4/.style={draw, rectangle, rounded corners=2.5mm, fill=systemcolor, inner sep=10pt, minimum height=1cm, text width=5cm, align=center, text=white},
        relationship description c4/.style={-latex,black,very thick},
    }

    \pgfplotsset{
        selective show sum on top/.style={
            /pgfplots/scatter/@post marker code/.append code={%
                \ifnum\coordindex=#1
                    \node[
                        at={(normalized axis cs:%
                        \pgfkeysvalueof{/data point/x},%
                        \pgfkeysvalueof{/data point/y})%
                    },
                    anchor=south,
                    ]
                    {\pgfmathprintnumber{\pgfkeysvalueof{/data point/y}}};
                \fi
            },
        },
        selective show sum on top/.default=0,
    }

    \pgfplotsset{
        name nodes near coords/.style={
            every node near coord/.append style={
                name=#1-\coordindex,
                alias=#1-last,
            },
        },
        name nodes near coords/.default=coordnode
    }

    \newcommand{\derivative}[3]{\dfrac{#1#2}{#1#3}} 
    \newcommand{\pderivative}[3]{\dfrac{#1}{#1#3}\left(#2\right)} 
    \newcommand{\phiderivative}[2]{\dfrac{\partial\psi(#1)}{\partial #2}} 
    \newcommand{\mytextquote}[1]{<<#1>>}
    \newcommand{\updaterule}[1]{\ensuremath{\bs{#1}[(k+1)T] &= \bs{#1}[kT] - \eta_{#1} \nabla E_{\bs{#1}}[kT]}}

    \newcommand{\writematrix}[3]{
        \ensuremath{
            \begin{bmatrix}
                #1_{1,1} & #1_{1,2} & \ldots & #1_{1,#2} \\
                #1_{2,1} & #1_{2,2} & \ldots & #1_{2,#2} \\
                \vdots & \vdots & \ddots & \vdots \\
                #1_{#3,1} & #1_{#3,2} & \ldots & #1_{#3,#2}
            \end{bmatrix}
        }
    }

    \newcommand{\writematrixfbacks}[3]{
        \ensuremath{
            \begin{bmatrix}
                #1_{1,0} & #1_{1,1} & \ldots & #1_{1,#2} \\
                #1_{2,0} & #1_{2,1} & \ldots & #1_{2,#2} \\
                \vdots & \vdots & \ddots & \vdots \\
                #1_{#3,0} & #1_{#3,1} & \ldots & #1_{#3,#2}
            \end{bmatrix}
        }
    }

    \def\confere{consúltese~}
    \def\Confere{Consúltese~}
    \def\etal{\emph{et \'{a}l.}}
    \def\infra{veáse~abajo~}
    \def\subvoce{\emph{s. v.}~}
    \def\supra{veáse~arriba~}
    \def\see{véase~}
    \def\See{Véase~}
    \def\wavelet{\emph{wavelet}}
    \def\wavelets{\emph{wavelets}}
    \def\Wavelet{\emph{Wavelet}}
    \def\Wavelets{\emph{Wavelets}}

    \def\defequalto{\ensuremath{\overset{\text{def}}{=}}}

    % === Forest - Filepath ===
    % \definecolor{folderbg}{RGB}{124,166,198}
    % \definecolor{folderborder}{RGB}{110,144,169}
    % \tikzset{
    %     folder/.pic={
    %         \filldraw [draw=folderborder, top color=folderbg!50, bottom color=folderbg] (-1.05*\Size,0.2\Size+5pt) rectangle ++(.75*\Size,-0.2\Size-5pt);
    %         \filldraw [draw=folderborder, top color=folderbg!50, bottom color=folderbg] (-1.15*\Size,-\Size) rectangle (1.15*\Size,\Size);
    %     },
    %     file/.pic={
    %         \filldraw [draw=folderborder, top color=folderbg!5, bottom color=folderbg!10] (-\Size,.4*\Size+5pt) coordinate (a) |- (\Size,-1.2*\Size) coordinate (b) -- ++(0,1.6*\Size) coordinate (c) -- ++(-5pt,5pt) coordinate (d) -- cycle (d) |- (c) ;
    %     },
    % }

    % \forestset{
    %     declare autowrapped toks={pic me}{},
    %     pic dir tree/.style={%
    %         for tree={%
    %             folder,
    %             font=\ttfamily,
    %             grow'=0,
    %         },
    %         before typesetting nodes={%
    %             for tree={%
    %                 edge label+/.option={pic me},
    %             },
    %         },
    %     },
    %     pic me set/.code n args=2{%
    %         \forestset{%
    %             #1/.style={%
    %                 inner xsep=2\Size,
    %                 pic me={pic {#2}},
    %             }
    %         }
    %     },
    %     pic me set={directory}{folder},
    %     pic me set={file}{file},
    % }
% ========================================================
\endinput
% ========================================================
